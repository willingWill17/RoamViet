<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RoamViet - Tin nh·∫Øn</title>
    <link rel="icon" href="logo/logo-black.png" type="image/png" />
    <link rel="stylesheet" href="css/messaging_style.css?v=2024-fix" />
    <link rel="stylesheet" href="css/main_site_style.css" />
  </head>
  <body>
    <div class="background-slider"></div>

    <header>
      <div class="logo">
        <img src="logo/logo-white.png" alt="RoamViet Logo" />
        <span class="logo-text"><a href="main_site.html">RoamViet</a></span>
      </div>
      <nav>
        <ul class="main-nav">
          <!-- <li><a href="checkin.html">Check-in</a></li> -->
          <li><a href="schedule.html">Schedule</a></li>
          <li><a href="all_63.html">63 t·ªânh th√†nh</a></li>
          <li><a href="messaging.html" class="active">Tin nh·∫Øn</a></li>
        </ul>
      </nav>
      <div class="contact-icons">
        <a href="contact.html" class="icon phone">
          <img src="logo/phone-icon-white.png" alt="Phone" />
        </a>
        <a
          href="contact.html"
          class="icon email"
          id="emailNotificationIconContainer"
        >
          <img src="logo/email-icon-white.png" alt="Email" />
          <span
            class="notification-badge"
            id="friendRequestBadge"
            style="display: none"
            >0</span
          >
        </a>
        <a href="profile.html" class="icon profile">
          <img src="logo/profile-icon-white.png" alt="Profile" />
        </a>
        <button
          onclick="logout()"
          class="icon logout"
          style="background: none; border: none; cursor: pointer"
        >
          <img
            src="logo/logout-icon-white.png"
            alt="Logout"
            style="width: 24px; height: 24px"
          />
        </button>
      </div>
    </header>

    <main class="messaging-container">
      <div class="messaging-layout">
        <!-- Chat Sidebar -->
        <div class="chat-sidebar">
          <div class="sidebar-header">
            <!-- Friend Request Section (appears when there are requests) -->
            <div
              id="friendRequestBlock"
              class="friend-request-section"
              style="display: none"
            >
              <h2>üîî Y√™u c·∫ßu k·∫øt b·∫°n</h2>
              <div class="friend-request-list" id="friendRequestList">
                <!-- Friend requests will appear here -->
              </div>
            </div>

            <!-- Add Friend Search Section -->
            <div class="friend-search-section">
              <h2>Th√™m b·∫°n b√®</h2>
              <input
                type="text"
                id="searchFriendInput"
                placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng ƒë·ªÉ th√™m b·∫°n..."
                oninput="searchUsers()"
              />
              <div
                class="friend-search-results-container"
                id="friendSearchResultsContainer"
              >
                <!-- Friend search results will appear here -->
              </div>
            </div>
            <!-- End Add Friend Search Section -->

            <h2 style="margin-top: 10px">Tin nh·∫Øn</h2>
            <!-- <button class="new-chat-btn" onclick="openNewChatModal()"> -->
            <!-- <span>+</span> Cu·ªôc tr√≤ chuy·ªán m·ªõi -->
            <!-- </button> -->
          </div>

          <div class="search-container">
            <input
              type="text"
              id="searchConversations"
              placeholder="T√¨m ki·∫øm cu·ªôc tr√≤ chuy·ªán..."
            />
          </div>

          <div class="conversation-list" id="conversationList">
            <div class="loading-message">ƒêang t·∫£i cu·ªôc tr√≤ chuy·ªán...</div>
          </div>
        </div>

        <!-- Chat Main Area -->
        <div class="chat-main">
          <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
              <h3>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Tin nh·∫Øn RoamViet!</h3>
              <p>
                K·∫øt n·ªëi v·ªõi nh·ªØng ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh trong h√†nh tr√¨nh kh√°m ph√°
                Vi·ªát Nam
              </p>

              <div class="instructions">
                <h4>üì± C√°ch s·ª≠ d·ª•ng:</h4>
                <ul>
                  <li>üîç Nh·∫•n "Cu·ªôc tr√≤ chuy·ªán m·ªõi" ƒë·ªÉ t√¨m b·∫°n b√®</li>
                  <li>üìß Nh·∫≠p email ch√≠nh x√°c c·ªßa ng∆∞·ªùi b·∫°n mu·ªën nh·∫Øn tin</li>
                  <li>üí¨ B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán v√† chia s·∫ª tr·∫£i nghi·ªám du l·ªãch</li>
                  <li>
                    üåü M·ªùi b·∫°n b√® ƒëƒÉng k√Ω v·ªõi email: buddy@roamviet.com ƒë·ªÉ test
                  </li>
                </ul>
              </div>

              <button class="start-chat-btn" onclick="openNewChatModal()">
                B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán
              </button>
            </div>
          </div>

          <!-- Conversation Header -->
          <div
            class="conversation-header"
            id="conversationHeader"
            style="display: none"
          >
            <div class="conversation-user-info">
              <div class="user-avatar">
                <img
                  id="conversationUserAvatar"
                  src="logo/profile-icon-white.png"
                  alt="User"
                />
              </div>
              <div class="user-details">
                <h3 id="conversationUserName">T√™n ng∆∞·ªùi d√πng</h3>
              </div>
            </div>
            <div class="conversation-actions">
              <button class="action-btn" onclick="clearConversation()">
                X√≥a cu·ªôc tr√≤ chuy·ªán
              </button>
            </div>
          </div>

          <!-- Messages Area -->
          <!-- 
            Message positioning: 
            - Your messages appear on the RIGHT with blue background
            - Other user's messages appear on the LEFT with white background
            - Each message has an avatar indicator
            - To test positioning, open browser console and type: testMessagePositioning()
          -->
          <div
            class="messages-container"
            id="messagesContainer"
            style="display: none"
          >
            <div class="messages-list" id="messagesList">
              <!-- Messages will be loaded here -->
            </div>
          </div>

          <!-- Message Input -->
          <div
            class="message-input-container"
            id="messageInputContainer"
            style="display: none"
          >
            <div class="message-input">
              <input
                type="text"
                id="messageInput"
                placeholder="Nh·∫≠p tin nh·∫Øn..."
                onkeypress="handleMessageKeyPress(event)"
              />
              <button class="attachment-btn" onclick="handleAttachment()">
                üìé
              </button>
              <button class="share-memory-btn" onclick="openShareMemoryModal()">
                üéÅ Share Memory
              </button>
              <button class="send-btn" onclick="sendMessage()">G·ª≠i</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- New Chat Modal -->
    <div class="modal" id="newChatModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Cu·ªôc tr√≤ chuy·ªán m·ªõi</h3>
          <button class="close-btn" onclick="closeNewChatModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="search-users-container">
            <input
              type="text"
              id="searchUsers"
              placeholder="Nh·∫≠p email ho·∫∑c t√™n ng∆∞·ªùi d√πng..."
              oninput="searchUsers()"
            />
            <div class="search-instructions">
              üí° G·ª£i √Ω: Nh·∫≠p email ch√≠nh x√°c ƒë·ªÉ t√¨m ng∆∞·ªùi d√πng (VD:
              buddy@roamviet.com)
            </div>
          </div>
          <div class="users-list" id="usersList">
            <div class="loading-message">
              Nh·∫≠p email ho·∫∑c t√™n ƒë·ªÉ t√¨m ki·∫øm ng∆∞·ªùi d√πng...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Share Memory Modal (Memory Panel) -->
    <div class="modal" id="shareMemoryModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Share a Memory</h3>
          <button class="close-btn" onclick="closeShareMemoryModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="memoryFile">Select memory (image, video, etc.):</label>
            <input
              type="file"
              id="memoryFile"
              name="memoryFile"
              accept="image/*,video/*,.pdf,.doc,.docx,.txt"
            />
          </div>
          <div class="form-group search-users-container">
            <label for="shareWithUserEmail">Share with (enter email):</label>
            <input
              type="text"
              id="shareWithUserEmail"
              placeholder="Enter user's email..."
              oninput="searchUsersForSharing()"
            />
            <div class="search-instructions">
              Type the email of the user you want to share with.
            </div>
          </div>
          <div class="users-list" id="shareUserSuggestionList">
            <!-- User suggestions will appear here -->
            <div class="loading-message">Enter an email to find users.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="handleShareMemory()">
            Share Memory
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Friend Detail Modal (NEW) -->
    <div class="modal" id="friendDetailModal">
      <div class="modal-content friend-detail-modal-content">
        <div class="modal-header">
          <h3>Th√¥ng tin ng∆∞·ªùi d√πng</h3>
          <button class="close-btn" onclick="closeFriendDetailModal()">
            &times;
          </button>
        </div>
        <div class="modal-body friend-detail-modal-body">
          <div class="friend-detail-avatar-container">
            <img
              id="friendDetailAvatar"
              src="logo/profile-icon-white.png"
              alt="User Avatar"
              class="friend-detail-avatar-img"
            />
            <div
              id="friendDetailAvatarInitial"
              class="friend-detail-avatar-initial"
              style="display: none"
            >
              ?
            </div>
          </div>
          <h4 id="friendDetailUsername">T√™n ng∆∞·ªùi d√πng</h4>
          <p id="friendDetailEmail" class="friend-detail-email-text">
            email@example.com
          </p>
          <button
            id="friendDetailAddBtn"
            class="btn btn-primary add-friend-detail-btn"
            onclick=""
          >
            Th√™m b·∫°n b√®
          </button>
          <p
            id="friendDetailStatusMsg"
            class="friend-detail-status"
            style="display: none"
          ></p>
        </div>
      </div>
    </div>

    <script src="script/accounts.js"></script>
    <script src="script/messaging_script.js?v=2024-profile"></script>
  </body>
</html>

<!-- Friend Request Panel (Add this at the end of the body) -->
<div class="friend-request-panel" id="friendRequestPanel">
  <div class="panel-header">
    <h3>Friend Requests</h3>
    <button class="close-panel-btn" id="closeFriendRequestPanelBtn">
      &times;
    </button>
  </div>
  <div class="panel-body" id="friendRequestListContainer">
    <!-- Friend requests will be dynamically inserted here -->
    <!-- Example of a single request item (for styling reference) -->
    <!-- 
    <div class="friend-request-item">
      <div class="request-item-avatar">
        <img src="logo/profile-icon-white.png" alt="User">
      </div>
      <div class="request-item-info">
        <div class="request-item-name">User Name</div>
        <div class="request-item-email">user@example.com</div>
      </div>
      <div class="request-item-actions">
        <button class="btn-accept">Accept</button>
        <button class="btn-decline">Decline</button>
      </div>
    </div>
    -->
    <div class="loading-message" id="friendRequestPanelLoadingMsg">
      Loading requests...
    </div>
  </div>
</div>
