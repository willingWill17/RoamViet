<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RoamViet - Tin nh·∫Øn</title>
    <link rel="icon" href="logo/logo-black.png" type="image/png" />
    <link rel="stylesheet" href="css/messaging_style.css?v=2024-fix" />
    <link rel="stylesheet" href="css/main_site_style.css" />
  </head>
  <body>
    <div class="background-slider"></div>

    <header>
      <div class="logo">
        <img src="logo/logo-white.png" alt="RoamViet Logo" />
        <span class="logo-text"><a href="main_site.html">RoamViet</a></span>
      </div>
      <nav>
        <ul class="main-nav">
          <li><a href="checkin.html">Check-in</a></li>
          <li><a href="schedule.html">Schedule</a></li>
          <li><a href="all_63.html">63 t·ªânh th√†nh</a></li>
          <li><a href="messaging.html" class="active">Tin nh·∫Øn</a></li>
        </ul>
      </nav>
      <div class="contact-icons">
        <a href="contact.html" class="icon phone">
          <img src="logo/phone-icon-white.png" alt="Phone" />
        </a>
        <a href="contact.html" class="icon email">
          <img src="logo/email-icon-white.png" alt="Email" />
        </a>
        <a href="profile.html" class="icon profile">
          <img src="logo/profile-icon-white.png" alt="Profile" />
        </a>
        <button
          onclick="logout()"
          class="icon logout"
          style="background: none; border: none; cursor: pointer"
        >
          <img
            src="logo/logout-icon-white.png"
            alt="Logout"
            style="width: 24px; height: 24px"
          />
        </button>
      </div>
    </header>

    <main class="messaging-container">
      <div class="messaging-layout">
        <!-- Chat Sidebar -->
        <div class="chat-sidebar">
          <div class="sidebar-header">
            <h2>Tin nh·∫Øn</h2>
            <button class="new-chat-btn" onclick="openNewChatModal()">
              <span>+</span> Cu·ªôc tr√≤ chuy·ªán m·ªõi
            </button>
          </div>

          <div class="search-container">
            <input
              type="text"
              id="searchConversations"
              placeholder="T√¨m ki·∫øm cu·ªôc tr√≤ chuy·ªán..."
            />
          </div>

          <div class="conversation-list" id="conversationList">
            <div class="loading-message">ƒêang t·∫£i cu·ªôc tr√≤ chuy·ªán...</div>
          </div>
        </div>

        <!-- Chat Main Area -->
        <div class="chat-main">
          <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
              <h3>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Tin nh·∫Øn RoamViet!</h3>
              <p>
                K·∫øt n·ªëi v·ªõi nh·ªØng ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh trong h√†nh tr√¨nh kh√°m ph√°
                Vi·ªát Nam
              </p>

              <div class="instructions">
                <h4>üì± C√°ch s·ª≠ d·ª•ng:</h4>
                <ul>
                  <li>üîç Nh·∫•n "Cu·ªôc tr√≤ chuy·ªán m·ªõi" ƒë·ªÉ t√¨m b·∫°n b√®</li>
                  <li>üìß Nh·∫≠p email ch√≠nh x√°c c·ªßa ng∆∞·ªùi b·∫°n mu·ªën nh·∫Øn tin</li>
                  <li>üí¨ B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán v√† chia s·∫ª tr·∫£i nghi·ªám du l·ªãch</li>
                  <li>
                    üåü M·ªùi b·∫°n b√® ƒëƒÉng k√Ω v·ªõi email: buddy@roamviet.com ƒë·ªÉ test
                  </li>
                </ul>
              </div>

              <button class="start-chat-btn" onclick="openNewChatModal()">
                B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán
              </button>
            </div>
          </div>

          <!-- Conversation Header -->
          <div
            class="conversation-header"
            id="conversationHeader"
            style="display: none"
          >
            <div class="conversation-user-info">
              <div class="user-avatar">
                <img
                  id="conversationUserAvatar"
                  src="logo/profile-icon-white.png"
                  alt="User"
                />
              </div>
              <div class="user-details">
                <h3 id="conversationUserName">T√™n ng∆∞·ªùi d√πng</h3>
                <span class="user-status" id="conversationUserStatus"
                  >ƒêang ho·∫°t ƒë·ªông</span
                >
              </div>
            </div>
            <div class="conversation-actions">
              <button class="action-btn" onclick="clearConversation()">
                X√≥a cu·ªôc tr√≤ chuy·ªán
              </button>
            </div>
          </div>

          <!-- Messages Area -->
          <!-- 
            Message positioning: 
            - Your messages appear on the RIGHT with blue background
            - Other user's messages appear on the LEFT with white background
            - Each message has an avatar indicator
            - To test positioning, open browser console and type: testMessagePositioning()
          -->
          <div
            class="messages-container"
            id="messagesContainer"
            style="display: none"
          >
            <div class="messages-list" id="messagesList">
              <!-- Messages will be loaded here -->
            </div>
          </div>

          <!-- Message Input -->
          <div
            class="message-input-container"
            id="messageInputContainer"
            style="display: none"
          >
            <div class="message-input">
              <input
                type="text"
                id="messageInput"
                placeholder="Nh·∫≠p tin nh·∫Øn..."
                onkeypress="handleMessageKeyPress(event)"
              />
              <button class="attachment-btn" onclick="handleAttachment()">
                üìé
              </button>
              <button class="send-btn" onclick="sendMessage()">G·ª≠i</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- New Chat Modal -->
    <div class="modal" id="newChatModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Cu·ªôc tr√≤ chuy·ªán m·ªõi</h3>
          <button class="close-btn" onclick="closeNewChatModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="search-users-container">
            <input
              type="text"
              id="searchUsers"
              placeholder="Nh·∫≠p email ho·∫∑c t√™n ng∆∞·ªùi d√πng..."
              oninput="searchUsers()"
            />
            <div class="search-instructions">
              üí° G·ª£i √Ω: Nh·∫≠p email ch√≠nh x√°c ƒë·ªÉ t√¨m ng∆∞·ªùi d√πng (VD:
              buddy@roamviet.com)
            </div>
          </div>
          <div class="users-list" id="usersList">
            <div class="loading-message">
              Nh·∫≠p email ho·∫∑c t√™n ƒë·ªÉ t√¨m ki·∫øm ng∆∞·ªùi d√πng...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <script src="script/accounts.js"></script>
    <script src="script/messaging_script.js?v=2024-profile"></script>
  </body>
</html>
